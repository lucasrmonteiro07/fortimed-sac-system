â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… ANA PAULA VERÃ TODAS AS OCORRÃŠNCIAS - PRONTO PARA IMPLEMENTAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š CONFIGURAÃ‡ÃƒO FINAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ANA PAULA (Admin):
  âœ… VÃª TODAS as ocorrÃªncias
  âœ… Pode criar ocorrÃªncias
  âœ… Pode editar ocorrÃªncias
  âœ… Acesso total

VENDEDORES (Users):
  âœ… Veem APENAS suas ocorrÃªncias
  âŒ NÃ£o veem outras
  âœ… Podem criar suas prÃ³prias


ğŸš€ CÃ“DIGO PARA EXECUTAR (NO SUPABASE)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ALTER TABLE occurrences ENABLE ROW LEVEL SECURITY;

CREATE POLICY admin_can_view_all_occurrences ON occurrences
FOR SELECT
USING ((SELECT role FROM public.users WHERE id = auth.uid()) = 'admin');

CREATE POLICY users_can_view_own_occurrences ON occurrences
FOR SELECT
USING ((SELECT role FROM public.users WHERE id = auth.uid()) != 'admin'
  AND user_id = auth.uid());

CREATE POLICY admin_can_create_occurrences ON occurrences
FOR INSERT
WITH CHECK ((SELECT role FROM public.users WHERE id = auth.uid()) = 'admin');

CREATE POLICY users_can_create_own_occurrences ON occurrences
FOR INSERT
WITH CHECK ((SELECT role FROM public.users WHERE id = auth.uid()) != 'admin'
  AND user_id = auth.uid());

CREATE POLICY admin_can_update_occurrences ON occurrences
FOR UPDATE
USING ((SELECT role FROM public.users WHERE id = auth.uid()) = 'admin');

CREATE POLICY users_can_update_own_occurrences ON occurrences
FOR UPDATE
USING ((SELECT role FROM public.users WHERE id = auth.uid()) != 'admin'
  AND user_id = auth.uid());


ğŸ“ PASSOS
â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Abra: https://app.supabase.com/
2. SQL Editor > New Query
3. Cole o cÃ³digo acima (COMPLETO)
4. Clique: Run
5. Aguarde "success" mÃºltiplas vezes
6. Recarregue a pÃ¡gina do sistema
7. Teste o login


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ReferÃªncia: ADMIN_EDITAR_DELETAR_QUALQUER_OCORRENCIA.txt
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
