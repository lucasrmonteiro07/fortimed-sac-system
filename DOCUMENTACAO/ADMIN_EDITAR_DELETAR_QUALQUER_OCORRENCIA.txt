â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                            â•‘
â•‘            âœ… PERMITIR ANA PAULA VER TODAS AS OCORRÃŠNCIAS                 â•‘
â•‘                                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸ¯ O QUE VAI ACONTECER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ANTES:
  â€¢ Ana Paula via apenas suas ocorrÃªncias
  â€¢ Vendedores viam apenas suas ocorrÃªncias

DEPOIS:
  âœ… Ana Paula (Admin) vÃª TODAS as ocorrÃªncias
  âœ… Vendedores continuam vendo apenas suas prÃ³prias


ğŸš€ EXECUTE ISTO NO SUPABASE SQL EDITOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ALTER TABLE occurrences ENABLE ROW LEVEL SECURITY;

CREATE POLICY admin_can_view_all_occurrences ON occurrences
FOR SELECT
USING ((SELECT role FROM public.users WHERE id = auth.uid()) = 'admin');

CREATE POLICY users_can_view_own_occurrences ON occurrences
FOR SELECT
USING ((SELECT role FROM public.users WHERE id = auth.uid()) != 'admin'
  AND user_id = auth.uid());

CREATE POLICY admin_can_create_occurrences ON occurrences
FOR INSERT
WITH CHECK ((SELECT role FROM public.users WHERE id = auth.uid()) = 'admin');

CREATE POLICY users_can_create_own_occurrences ON occurrences
FOR INSERT
WITH CHECK ((SELECT role FROM public.users WHERE id = auth.uid()) != 'admin'
  AND user_id = auth.uid());

CREATE POLICY admin_can_update_occurrences ON occurrences
FOR UPDATE
USING ((SELECT role FROM public.users WHERE id = auth.uid()) = 'admin');

CREATE POLICY users_can_update_own_occurrences ON occurrences
FOR UPDATE
USING ((SELECT role FROM public.users WHERE id = auth.uid()) != 'admin'
  AND user_id = auth.uid());


ğŸ“ COMO EXECUTAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Abra: https://app.supabase.com/
2. SQL Editor > New Query
3. Cole TODO o SQL acima
4. Clique: "Run"
5. Aguarde mÃºltiplos "success"
6. Pronto! âœ…


âœ… TESTE DEPOIS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Login como Ana Paula:
  â€¢ VÃ¡ para RelatÃ³rios
  â€¢ Deve ver TODAS as ocorrÃªncias

Login como Vendedor:
  â€¢ VÃ¡ para RelatÃ³rios
  â€¢ VÃª apenas suas ocorrÃªncias


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Arquivo completo: SQL/permitir-admin-ver-todas-ocorrencias.sql
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
