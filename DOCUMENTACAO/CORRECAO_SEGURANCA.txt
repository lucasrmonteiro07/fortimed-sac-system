âš ï¸ VENDAS01 VÃŠ APENAS SUAS OCORRÃŠNCIAS - SOLUÃ‡ÃƒO FINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ” PROBLEMA ATUAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Alterou seguranÃ§a
âœ… Desabilitou RLS
âŒ MAS: vendas01 ainda vÃª APENAS suas ocorrÃªncias

ğŸ“ CAUSA
â”€â”€â”€â”€â”€â”€â”€â”€
As POLÃTICAS RLS antigas ainda estÃ£o ativas.
Precisa REMOVER as polÃ­ticas, depois desabilitar RLS.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… SOLUÃ‡ÃƒO (4 LINHAS)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

No Supabase SQL Editor, execute isto EM SEQUÃŠNCIA:


1ï¸âƒ£ DROP POLICY IF EXISTS admin_can_view_all_occurrences ON occurrences;

2ï¸âƒ£ DROP POLICY IF EXISTS users_can_view_own_occurrences ON occurrences;

3ï¸âƒ£ DROP POLICY IF EXISTS admin_can_create_occurrences ON occurrences;

4ï¸âƒ£ DROP POLICY IF EXISTS users_can_create_own_occurrences ON occurrences;

5ï¸âƒ£ DROP POLICY IF EXISTS admin_can_update_occurrences ON occurrences;

6ï¸âƒ£ DROP POLICY IF EXISTS users_can_update_own_occurrences ON occurrences;

7ï¸âƒ£ ALTER TABLE occurrences DISABLE ROW LEVEL SECURITY;


Resultado esperado: "success" para cada linha


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ PASSO A PASSO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. https://app.supabase.com/

2. SQL Editor > New Query

3. Cole CADA linha acima (uma por uma) e clique "Run"

4. Ao terminar, recarregue tudo:
   â€¢ Ctrl+Shift+R (hard refresh)
   â€¢ FaÃ§a logout
   â€¢ FaÃ§a login novamente com vendas01
   â€¢ VÃ¡ para RelatÃ³rios

5. Agora vendas01 deve ver TODAS as ocorrÃªncias! âœ…


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… VERIFICAÃ‡ÃƒO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Execute isto para confirmar:

SELECT tablename, rowsecurity FROM pg_tables WHERE tablename = 'occurrences';

Resultado esperado:
  tablename  | rowsecurity
  occurrences| false  (RLS estÃ¡ DESABILITADO)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ§ª TESTE FINAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Login como vendas01
2. VÃ¡ para RelatÃ³rios
3. Veja ocorrÃªncias de TODOS
4. âœ… Se ver tudo = Problema resolvido!
5. âŒ Se ainda sÃ³ vÃª suas = Problema no cÃ³digo JavaScript


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ SE AINDA NÃƒO FUNCIONAR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Pode ser filtro NO CÃ“DIGO (nÃ£o no banco):

Procure em app.js:
  SELECT * FROM occurrences WHERE user_id = auth.uid()

Se encontrar, comente e teste novamente.


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
